{% extends "base.html" %}
{% block content %}

                        <form  method="POST" class="glass-morphism-container1"  name="form1" id="form1">
                        <h3 class="form-heading">Scout Registration</h3>
                        {% csrf_token %}
                        <div class="d-flex justify-content-center" >
                            <div class="spinner-border"  role="status" >
                              <span class="sr-only">..</span>
                            </div>
                          </div>
                        <input type="hidden" name="_token" value="b1nCcqafDVGwwKwH5DLWqeD06kDWSQBXGrPwAco3">
                            <div class="row">
                                <div class="col-lg-6 col-md-6 col-sm-12 mt-3">
                                    <div class="form-group">
                                        <label class="text-left">{{first_name}}<span class="mandatory">* </span></label>
                                        <input class="form-control" type="text" name="first_name"  id="first_name" required minlength="3">
                                    </div>
                                </div>

                                <div class="col-lg-6 col-md-6 col-sm-12 mt-3">
                                    <div class="form-group">
                                        <label class="text-left">{{last_name}}<span class="mandatory">* </span></label>
                                        <input class="form-control" type="text" name="last_name" id="last_name" required minlength="3">
                                    </div>
                                </div>
                                <div class="col-lg-6 col-md-6 col-sm-12 mt-3">
                                    <div class="form-group">
                                        <label class="text-left">Your State<span class="mandatory">*
                                            </span></label>
                                        <select class="form-control" name="state" id="state" required="">
                                            <option value="">Select State </option>
                                            


                                        </select>
                                    </div>
                                </div>

                                <div class="col-lg-6 col-md-6 col-sm-12 mt-3">
                                    <div class="form-group">
                                        <label class="text-left">Your City<span class="mandatory">*
                                            </span></label>
                                        <select id="city" name="city" class="form-control"  required="">
                                            <option value="">Select City</option>


                             
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="col-lg-6 col-md-6 col-sm-12 mt-3">
                                    <div class="form-group">
                                        <label class="text-left">{{gender}}<span class="mandatory">*
                                            </span></label>
                                        <select class="form-control" name="gender" id="gender" required="" data-fillr-id="1552374762" data-fillr="bound" autocomplete="off">
                                            <option value="">{{dropdown_select_gender}} </option>
                                          
                                            <option value="Male">{{male}}</option>
                                            <option value="Female">{{female}} </option>
                                        </select>
                                    </div>
                                </div>

                                <div class="col-lg-6 col-md-6 col-sm-12 mt-3">
                                    <div class="form-group">
                                        <label class="text-left"> {{dob}}<span class="mandatory">* </span></label>
                                        <input class="form-control" type="date" name="dob" id="dob" required>
                                    </div>
                                </div>

                                <div class="col-lg-6 col-md-6 col-sm-12 mt-3">
                                    <div class="form-group">
                                        <label class="text-left">{{email}}<span class="mandatory">
                                            </span></label>
                                        <input class="form-control" type="email" title="Please Enter Email Id"  name="email"  id="email">
                                        <span id="message"></span>
                                    </div>
                                </div>
                                <div class="col-lg-6 col-md-6 col-sm-12 mt-3">
                                    <div class="form-group">
                                        <label class="text-left" >{{mobile}}<span class="mandatory">* </span></label>
                                        <div class="input-group">
                                            <input type="text" class="form-control" value="+91" readonly style="max-width:6ch;"/>
                                            <span class="input-group-addon">-</span>
                                            <input class="form-control" type="number" minlength="10" width="90%" onkeydown="limitmob(this,10);" onkeyup="limitmob(this,10);" name="mobile"  id="mobile" pattern=".{10,}"  required>
                                        </div>
                                       
                                    </div>
                                </div>
                                <div class="col-lg-6 col-md-6 col-sm-12 mt-3">
                                    <div class="form-group">
                                        <label class="text-left">Associated With Football from how many years ?<span class="mandatory">* </span></label>
                                        <input class="form-control" type="text" name="associated_years"  id="assosicated_years" required minlength="3">
                                    </div>
                                </div>
                                <div class="col-lg-12 col-md-12 col-sm-12 mt-3">
                                    <div class="form-group">
                                        <label class="text-left">Associated with football as (can select multiple) <span class="mandatory">*
                                            </span></label>
                                            <div class="form-check">
                                                
                                                <label class="form-check-label" for="player">
                                                  player
                                                </label>
                                                <input class="form-check-input"  onchange="checkfun(this)" type="radio" name="association_as" id="player" value="player">
                                              </div>
                                              <div class="form-check">
                                                
                                                <label class="form-check-label" for="coach">
                                                  Coach
                                                </label>
                                                <input class="form-check-input" onchange="checkfun(this)" type="radio" name="association_as" id="coach" value="coach" checked>
                                              </div>
                                              <div class="form-check">
                                                
                                                <label class="form-check-label" for="refree">
                                                  Refree
                                                </label>
                                                <input class="form-check-input" onchange="checkfun(this)" type="radio" name="association_as" id="refree" value="refree" checked>
                                              </div>
                                              <div class="form-check">
                                                
                                                <label class="form-check-label" for="academy_owner">
                                                    Academy Owner
                                                </label>
                                                <input class="form-check-input" onchange="checkfun(this)" type="radio" name="association_as" id="academy_owner" value="academy_owner" checked>
                                              </div>
                                              <div class="form-check">
                                                
                                                <label class="form-check-label" for="other">
                                                    Other
                                                </label>
                                                <input class="form-check-input" onchange="checkfun(this)" type="radio" name="association_as" id="other" value="other" checked>
                                              </div>
                                        <span id="message"></span>
                                    </div>
                                </div>

                                <div class="col-lg-12 col-md-12 col-sm-12 mt-3">
                                    <div class="form-group">
                                        <label class="text-left">Interested For: <span class="mandatory">*
                                            </span></label>
                                            <div class="form-check">
                                                
                                                <label class="form-check-label" for="course1">
                                                    Course 1 – PFSA Talent Identification certification only – Fees Rs.3999
                                                </label>
                                                <input class="form-check-input"  onchange="checkfun(this)" type="radio" name="courseradio" id="course1" value="course1">
                                              </div>
                                              <div class="form-check">
                                                
                                                <label class="form-check-label" for="course2">
                                                    Course 2 – Three Modules + chance to become IKF Partner scout – Fees Rs.7499
                                                </label>
                                                <input class="form-check-input" onchange="checkfun(this)" type="radio" name="courseradio" id="course2" value="course2" checked>
                                              </div>

                                        <span id="message"></span>
                                    </div>
                                </div>
                                <div class="col-lg-6 col-md-6 col-sm-12 mt-3">
                                    <div class="form-group">
                                        <label class="text-left">Referral Code<span class="mandatory">* </span></label>
                                        <input class="form-control" type="text" name="referral_code"  id="referral_code" required minlength="3">
                                    </div>
                                </div>

                                <div class="col-lg-6 col-md-6 col-sm-12 mt-3">
                                    <div class="form-group">
                                        <label class="text-left">Discount Code<span class="mandatory">* </span></label>
                                        <input class="form-control" type="text" name="discount_code" id="discount_code" required minlength="3">
                                    </div>
                                </div>
                                {% comment %} <div class="col-lg-12 col-md-12 col-sm-12 mt-3 border p-3 rounded bg-white">
                                    <div class="custom-control custom-checkbox checkbox-lg">
                                        <input type="checkbox" class="custom-control-input" id="checkbox-2" required>
                                        <label class="custom-control-label" for="checkbox-2"> By supplying my contact
                                            information, I authorize the organiser exchange4media and sponsors to
                                            contact me via personalized communications about their products and services
                                            via email and phone. See our <a href="https://www.exchange4media.com/privacy-policy.html" target="_blank" style="text-decoration:underline;">Privacy Policy</a>
                                            for more details or to opt-out at any time.<span class="mandatory"> *
                                            </span></label>
                                    </div>
                                </div> {% endcomment %}
                                <div class="d-flex justify-content-center" >
                                    <div class="spinner-border"  role="status" >
                                      <span class="sr-only">..</span>
                                    </div>
                                  </div>
                                <div class="text-center col-lg-12 col-md-12 col-sm-12 mt-3">
                                    <div class="form-group mb-0">
                                        <button class="btn login-btn" onclick="prev(this)" formnovalidate> {{prev}} </button>
                                        <button class="btn login-btn" onclick="next(this)" type="submit"> Save</button>
                                        <button class="btn login-btn" onclick="proceed_to_payment(this)" type="submit">Proceed to Payment</button>
                                    </div>
                                </div>

                            </div>
                        </form>
<script>
window.onbeforeunload=function(event){return "You have some unsaved changes";}
function checkempty(data){if(data==null||data==""||data==undefined){return ""}else{return data}}
function prev(node){
document.getElementById("form1").action="{% url 'homeindex'  %}"
}
function discountamount(course, type){

    $.ajax({
            type: "POST",
            url: "{% url 'scoutdiscountamount' %}",
            data:{type:type,course:course, csrfmiddlewaretoken:'{{ csrf_token }}'},
            success: function(result){
                      if (result){
                        
                        alert(result.discount)
                        

                      }
   
                    }
            })
}
function proceed_to_payment(self){
  $('.spinner-border').show();
  if(sessionStorage.getItem("saved") && sessionStorage.getItem('saved')=='true' ){
    IKFUNIQUEID=sessionStorage.getItem('ikfuniqueid')
    ID=sessionStorage.getItem('id')

  }

$.ajax({type: "POST",
        url: "{% url 'order' %}",
        data:{ikfuniqueid:IKFUNIQUEID,id:ID,amount:AMOUNT, csrfmiddlewaretoken:'{{csrf_token}}'} }
      ) .done(function (result) { 
        $('.spinner-border').hide();
                                  console.log(result)
                                  resultdata=JSON.parse(result)
                                 if(resultdata['error']=="true"){
                                               alert(resultdata['message'] )
                                    }
                                 else{try{
          alert("Order ID is generated Successfully");

        sessionStorage.setItem("order_id",resultdata['order_id'] )
        window.location="{% url 'payment' %}"
       
        
        }
        catch(e){

         alert(e.message)
        }

        
        
      } 
    
    })
    .fail(function (jqXHR, textStatus, errorThrown) { 
      $('.spinner-border').hide();
      alert("Order Api Error. Please Try Again") }); 

  }
function save(){
    $('.spinner-border').show();
        $.ajax({
          
          
          type: "POST",
          url: "{% url 'save' %}",
          data:{data:data,csrfmiddlewaretoken:'{{csrf_token}}'} 


        
        }
        
        ) 
        .done(function (result) {       console.log("done")
          console.log(result)
          resultdata=JSON.parse(result)
          console.log(resultdata)
          $('.spinner-border').hide();
          if(resultdata['error']=="true"){
            console.log("error",resultdata)
            alert(resultdata['message'] )
            
          }
          else{
            IKFUNIQUEID=resultdata["ikfuniqueid"]
            ID=resultdata["id"]
            sessionStorage.setItem("ikfuniqueid",IKFUNIQUEID)
            sessionStorage.setItem("id",ID)

            
            
            try{
              alert('Scout Data Submitted Successfully. Now click to "Proceed to Payment" button to go to Payment page.');


              document.getElementById("prev").disabled=true
            document.getElementById("next").disabled=true
            document.getElementById("proceed").disabled=false
            sessionStorage.setItem("saved","true")
           
            
            }
            catch(e){

             alert(e.message)
            }

            
            
          } 
        
        })
        .fail(function (jqXHR, textStatus, errorThrown) { 
          $('.spinner-border').hide();
          alert("Server API Error") });    
}
function next(node){
    window.onbeforeunload = null;

    // var course= document.getElementsByName("courseradio")[1].value
    var typetext=document.getElementById("discount_code").value
    if(typetext.length==6){
     var type="type1"
    }
    else if(typetext.length==7){
        var type="type2"
    }
    else if(typetext.length==8){
        var type="type3"
    }
    var course=$("input[type='radio'][name='courseradio']:checked").val();
    if (typetext.match(/^[0-9A-Za-z]+$/) === null) { 
 alert("not alphanumeric")
 }else{
    alert("alphanumeric")
    discountamount(course,type)
 }
   
    // var mobiledoc= document.getElementById("mobile").value
   
    // if(mobiledoc.indexOf('0')==0){

    //     alert("Mobile Number should not start with 0")
    // }
    // else if(mobiledoc.length<10){
    //     alert("Mobile Number Should be 10 Digit")
    // }
    // else{
    //     var formData = JSON.parse(JSON.stringify($('#form1').serializeArray()))
    //     var dict={}
    //     formData.forEach(function (item) {
    //        dict[item['name']]=item['value']
    //     });
    //     dict["whoisfilling"]="{{coach_or_player }}"
    //     if(dict['csrfmiddlewaretoken']){delete dict['csrfmiddlewaretoken']}
    //     if(dict['_token']){delete dict['_token']}
    //     if(sessionStorage.getItem("data")){
    //         var inputobj=JSON.parse(sessionStorage.getItem("data"))
    //         newdict=Object.assign(inputobj,dict);
    //         sessionStorage.setItem("data", JSON.stringify(newdict));
    //     } 
    //     else{
    //         sessionStorage.setItem("data", JSON.stringify(dict));
    //     }

        


        

       
        
            
    //         document.getElementById("form1").action="{% url 'preview1'  %}"

    // }

}


function converter(doc,statevalue, cityvalue){
          var citydoc=doc
          var cityvalue=cityvalue
          $.ajax({
            type: "POST",
            url: "{% url 'citydata' %}",
            data:{state:statevalue,csrfmiddlewaretoken:'{{ csrf_token }}'},
            success: function(result){
                      if (result){
                        var citydata=JSON.parse(result)
                        for (var x in citydata) {
                            citydoc.options[citydoc.options.length] = new Option(citydata[x].value, citydata[x].id);
                            }

                        citydoc.value=cityvalue 

                      }
   
                    }
            })
}


window.onload = function() {
$('.spinner-border').hide();
var stateSel = document.getElementById("state");
var citySel = document.getElementById("city");
var dobid=document.getElementById("dob");

if(sessionStorage.getItem("data")){
    var inputdatajson=JSON.parse(sessionStorage.getItem("data"))
    if(JSON.parse(sessionStorage.getItem("data"))["city"]){
        converter(citySel,inputdatajson["state"],inputdatajson["city"])

    }
}


$.ajax({
    type: "POST",
    url: "{% url 'statedata' %}",
    data:{include:1,csrfmiddlewaretoken:'{{ csrf_token }}'},
    success: function(result){
        statedata=JSON.parse(result)
        for (var x in statedata) {
            stateSel.options[stateSel.options.length] = new Option(statedata[x].value, statedata[x].id);
        }

        if(sessionStorage.getItem("data")){
            var datafortournament=JSON.parse(sessionStorage.getItem("data"))
            if(datafortournament){
                document.getElementById("state").value=""
                document.getElementById("state").value=datafortournament["state"]
                
            }
        }
}
}
)
stateSel.onchange = function(){
        citySel.length = 1;
        if(this.value){
        $.ajax({
        type: "POST",
        url: "{% url 'citydata' %}",
        data:{state:this.value,csrfmiddlewaretoken:'{{ csrf_token }}'},
        success: function(result){
                    citydata=JSON.parse(result)
                    for (var x in citydata) {
                            citySel.options[citySel.options.length] = new Option(citydata[x].value, citydata[x].id);
                        }

                        
                }
        })
        //ajax city call end
        }
}
                                 
citySel.onclick=function(){
if(stateSel.value){
console.log("")
}
else{
     alert("Please Select State First")
    }
}

$.ajax({
    type: "POST",
    url: "{% url 'limitdate' %}",
    data:{season:"S02",csrfmiddlewaretoken:'{{ csrf_token }}'},
    success: function(result){
     console.log(result);
     dobid.max=result["upperlimit"];
     dobid.min=result["lowerlimit"]

    },
    error:function(error){
        alert("API Error")
    }
    })

var formData = JSON.parse(JSON.stringify($('#form1').serializeArray()))
if(sessionStorage.getItem("data")){
    var inputdata=JSON.parse(sessionStorage.getItem("data"))
    if(inputdata){
      formData.forEach(item => {
        
           if(item['name']=='csrfmiddlewaretoken' || item['name']=='_token'||item['name']=='radiomobile'){}
           else{
            
            document.getElementById(item['name']).value=checkempty(inputdata[item['name']])}

            });


            

        
    }
}

                                                        


}



</script>
                        {% endblock %}   