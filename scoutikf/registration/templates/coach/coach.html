<style>
    hr{
        color:white;
        height: 1.5px !important;
    }
</style>


{% extends "base.html" %} {% block content %}



<form method="POST" class="glass-morphism-container1" name="form1" id="form1">
  <h3 class="form-heading">{{academy_form_heading}}</h3>
  {% csrf_token %}
  <input
    type="hidden"
    name="_token"
    value="b1nCcqafDVGwwKwH5DLWqeD06kDWSQBXGrPwAco3"
  />
  <div class="row">
    <div class="col-lg-6 col-md-6 col-sm-12 mt-3">
      <div class="form-group">
        <label class="text-left"
          >{{select_tournament_state}}<span class="mandatory">* </span></label
        >
        <select
          class="form-control"
          name="tournament_state"
          id="tournament_state"
          required=true
        >
          <option value="">{{dropdown_select_state}}</option>
        </select>
      </div>
    </div>

    <div class="col-lg-6 col-md-6 col-sm-12 mt-3">
      <div class="form-group">
        <label class="text-left"
          >{{select_tournament_city}}<span class="mandatory">* </span></label
        >
        <select
          id="tournament_city"
          name="tournament_city"
          class="form-control"
          required=""
        >
          <option value="">{{dropdown_select_city}}</option>
        </select>
      </div>
    </div>

    <div class="col-lg-6 col-md-6 col-sm-12 mt-3">
      <div class="form-group">
        <label class="text-left"
          >{{email}}<span class="mandatory"> </span
        ></label>
        <input
          class="form-control"
          type="email"
          title="Please Enter Email Id"
          name="academy_email"
          id="academy_email"
        />
        <span id="message"></span>
      </div>
    </div>
    <div class="col-lg-6 col-md-6 col-sm-12 mt-3">
      <div class="form-group">
        <label class="text-left"
          >{{mobile}}</label
        >
        <div class="input-group">
          <input
            type="text"
            class="form-control"
            value="+91"
            readonly
            style="max-width: 6ch"
          />
          <span class="input-group-addon">-</span>
          <input
            class="form-control"
            type="number"
            minlength="10"
            width="90%"
            onkeydown="limitmob(this,10);"
            onkeyup="limitmob(this,10);"
            name="academy_mobile"
            id="academy_mobile"
            pattern=".{10,}"
          />
        </div>
      </div>
    </div>

    <div class="col-lg-6 col-md-6 col-sm-12 mt-3">
      <div class="form-group">
        <label class="text-left"
          >{{academy_name}}</label>
        <input
          class="form-control"
          type="text"
          title="Please Enter Academy Name"
          name="academy_name"
          id="academy_name"
        />
        <span id="message"></span>
      </div>
    </div>

   <span style="margin-bottom:1.5em ;"></span>
   <hr>
   <span style="margin-top: 1em;"></span>
    <h3 class="form-heading">{{coach_form_heading}}</h3>
  <div class="row">
    
    <div class="col-lg-6 col-md-6 col-sm-12 mt-3">
        <div class="form-group">
          <label class="text-left"
            >{{coach_name}}<span class="mandatory">*</span
          ></label>
          <input
            class="form-control"
            type="text"
            title="Please Enter Academy Name"
            name="coach_name"
            id="coach_name"
            required
          />
          <span id="message"></span>
        </div>
      </div>
    

    <div class="col-lg-6 col-md-6 col-sm-12 mt-3">
      <div class="form-group">
        <label class="text-left"
          >{{email}}<span class="mandatory">*</span
        ></label>
        <input
          class="form-control"
          type="email"
          title="Please Enter Email Id"
          name="coach_email"
          id="coach_email"
          required="true"
        />
        <span id="message"></span>
      </div>
    </div>
    <div class="col-lg-6 col-md-6 col-sm-12 mt-3">
      <div class="form-group">
        <label class="text-left"
          >{{mobile}}<span class="mandatory">* </span></label
        >
        <div class="input-group">
          <input
            type="text"
            class="form-control"
            value="+91"
            readonly
            style="max-width: 6ch"
          />
          <span class="input-group-addon">-</span>
          <input
            class="form-control"
            type="number"
            minlength="10"
            width="90%"
            onkeydown="limitmob(this,10);"
            onkeyup="limitmob(this,10);"
            name="coach_mobile"
            id="coach_mobile"
            pattern=".{10,}"
            required=true,
          />
        </div>
      </div>
    </div>

    {% comment %}
    <div class="col-lg-12 col-md-12 col-sm-12 mt-3 border p-3 rounded bg-white">
      <div class="custom-control custom-checkbox checkbox-lg">
        <input
          type="checkbox"
          class="custom-control-input"
          id="checkbox-2"
          required
        />
        <label class="custom-control-label" for="checkbox-2">
          By supplying my contact information, I authorize the organiser
          exchange4media and sponsors to contact me via personalized
          communications about their products and services via email and phone.
          See our
          <a
            href="https://www.exchange4media.com/privacy-policy.html"
            target="_blank"
            style="text-decoration: underline"
            >Privacy Policy</a
          >
          for more details or to opt-out at any time.<span class="mandatory">
            *
          </span></label
        >
      </div>
    </div>
    {% endcomment %}

    <div class="text-center col-lg-12 col-md-12 col-sm-12 mt-3">
      <div class="form-group mb-0">
        <button class="btn login-btn" onclick="prev()" formnovalidate>
          {{prev}}
        </button>
        <button class="btn login-btn" onclick="next(this)" type="submit">
          {{next}}
        </button>
      </div>
    </div>
  </div>
</form>
<script>
  window.onbeforeunload = function (event) {
    return "You have some unsaved changes";
  };
  function checkempty(data) {
    if (data == null || data == "" || data == undefined) {
      return "";
    } else {
      return data;
    }
  }

  function check_mobile(mobiledoc){
    if(mobiledoc==""){
        alert("Phone number cant be empty");
        return false;
    }
    if (mobiledoc.indexOf("0") == 0) {
      alert("Mobile Number should not start with 0");
      return false;
    } 
    
    if (mobiledoc.length < 10) {
      alert("Mobile Number Should be 10 Digit");
      return false;
    }
    return true;
  }

  function prev() {
    history.back();
  }


  function next(node) {
    window.onbeforeunload = null;
    var academy_mobile = document.getElementById("academy_mobile").value;
    var coach_mobile = document.getElementById("coach_mobile").value;

    if( !check_mobile(coach_mobile)){
      return;
    }

      var formData = JSON.parse(JSON.stringify($("#form1").serializeArray()));
      var dict = {};
      formData.forEach(function (item) {
        console.log(item,'this is item')
        dict[item["name"]] = item["value"];
      });
      dict["whoisfilling"] = "{{coach_or_player }}";
      if (dict["csrfmiddlewaretoken"]) {
        delete dict["csrfmiddlewaretoken"];
      }
      if (dict["_token"]) {
        delete dict["_token"];
      }
      if (sessionStorage.getItem("academy_coach_details")) {
        var inputobj = JSON.parse(sessionStorage.getItem("academy_coach_details"));
        newdict = Object.assign(inputobj, dict);
        sessionStorage.setItem("academy_coach_details", JSON.stringify(newdict));
      } else {
        sessionStorage.setItem("academy_coach_details", JSON.stringify(dict));
      }

      console.log(formData);

      document.getElementById("form1").action = "{% url 'academypreview'  %}";
  }

  function converter(doc, statevalue, cityvalue) {
    var citydoc = doc;
    var cityvalue = cityvalue;
    $.ajax({
      type: "POST",
      url: "{% url 'citydata' %}",
      data: { state: statevalue, csrfmiddlewaretoken: "{{ csrf_token }}" },
      success: function (result) {
        if (result) {
          console.log("conveter id called");
          var citydata = JSON.parse(result);
          for (var x in citydata) {
            citydoc.options[citydoc.options.length] = new Option(
              citydata[x].value,
              citydata[x].id
            );
          }

          citydoc.value = cityvalue;
        }
      },
    });
  }

  window.onload = function () {
    var stateSel = document.getElementById("tournament_state");
    var citySel = document.getElementById("tournament_city");

    if (sessionStorage.getItem("academy_coach_details")) {
      var inputdatajson = JSON.parse(sessionStorage.getItem("academy_coach_details"));
      if (JSON.parse(sessionStorage.getItem("academy_coach_details"))["tournament_city"]) {
        converter(
          citySel,
          inputdatajson["tournament_state"],
          inputdatajson["tournament_city"]
        );
      }
    }

    $.ajax({
      type: "POST",
      url: "{% url 'statedata' %}",
      data: { include: 1, csrfmiddlewaretoken: "{{ csrf_token }}" },
      success: function (result) {
        statedata = JSON.parse(result);
        for (var x in statedata) {
          stateSel.options[stateSel.options.length] = new Option(
            statedata[x].value,
            statedata[x].id
          );
        }

        if (sessionStorage.getItem("academy_coach_details")) {
          var datafortournament = JSON.parse(sessionStorage.getItem("academy_coach_details"));
          if (datafortournament) {
            console.log("set state ");
            console.log(datafortournament);
            document.getElementById("tournament_state").value = "";
            document.getElementById("tournament_state").value =
              datafortournament["tournament_state"];
          }
        }
      },
    });
    stateSel.onchange = function () {
      citySel.length = 1;
      if (this.value) {
        $.ajax({
          type: "POST",
          url: "{% url 'citydata' %}",
          data: { state: this.value, csrfmiddlewaretoken: "{{ csrf_token }}" },
          success: function (result) {
            citydata = JSON.parse(result);
            for (var x in citydata) {
              citySel.options[citySel.options.length] = new Option(
                citydata[x].value,
                citydata[x].id
              );
            }
          },
        });
        //ajax city call end
      }
    };

    citySel.onclick = function () {
      if (stateSel.value) {
        console.log("");
      } else {
        alert("Please Select State First");
      }
    };

    var formData = JSON.parse(JSON.stringify($("#form1").serializeArray()));
    if (sessionStorage.getItem("academy_coach_details")) {
      var inputdata = JSON.parse(sessionStorage.getItem("academy_coach_details"));
      if (inputdata) {
        formData.forEach((item) => {
          if (
            item["name"] == "csrfmiddlewaretoken" ||
            item["name"] == "_token" ||
            item["name"] == "radiomobile"
          ) {
          } else {
            document.getElementById(item["name"]).value = checkempty(
              inputdata[item["name"]]
            );
          }
        });
      }
    }
  };
</script>
{% endblock %}
